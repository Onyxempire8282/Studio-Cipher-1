<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mileage Cipher - Claim Cipher</title>
    <!-- Universal System - Base styling -->
    <link rel="stylesheet" href="styles/universal-system.css" />

    <!-- Page Layout - Mileage Calculator specific -->
    <link rel="stylesheet" href="styles/mileage-cypher-layout.css" />

    <!-- Professional Calculator Interface -->
    <link rel="stylesheet" href="styles/professional-calculator.css" />
  </head>
  <body class="mileage-page">
    <header class="cipher-header">
      <div class="header-content">
        <div class="app-brand">
          <span class="logo">ğŸ¤</span>
          <span>Claim Cipher</span>
        </div>
        <div class="nav-links">
          <a href="command-center.html">ğŸ¯ Dashboard</a>
          <a href="route-cypher.html">ğŸ—ºï¸ Routes</a>
          <a href="mileage-cypher.html" class="active">ğŸ§® Mileage</a>
          <a href="jobs-studio.html">ğŸ’¼ Jobs</a>
          <a href="total-loss-forms.html">ğŸš— Forms</a>
          <a href="firms-directory.html">ğŸ¢ Firms</a>
          <a href="settings-booth.html">âš™ï¸ Settings</a>
          <a href="functionality-test.html">ğŸ§ª Tests</a>
        </div>
        <div class="user-section">
          <div class="user-info">
            <div class="user-name" id="userName">Professional User</div>
            <div class="user-role">Claims Specialist</div>
          </div>
          <button
            class="logout-btn cipher-btn cipher-btn--danger"
            onclick="handleLogout()"
          >
            Logout
          </button>
        </div>
      </div>
    </header>

    <main class="mileage-calculator-main">
      <div class="mileage-container">
        <!-- Calculator Section -->
        <div class="calculator-section cipher-glass-panel">
          <div class="section-header">
            <div class="section-title">
              <span class="section-icon">ğŸ§®</span>
              <h2>Mileage Calculator</h2>
            </div>
            <div class="section-subtitle">
              Calculate billable mileage for insurance claims
            </div>
          </div>

          <div class="calculator-form">
            <div class="form-section">
              <h3 class="form-section-title">
                <span class="form-icon">ğŸ¢</span>
                Insurance Firm Selection
              </h3>
              <div class="firm-selection-group">
                <div class="firm-input-group">
                  <label for="firmSelect" class="input-label"
                    >Select Your Firm</label
                  >
                  <select id="firmSelect" class="primary-select" required>
                    <option value="">Choose insurance firm...</option>
                  </select>
                </div>
                <button id="manageFirms" class="secondary-btn">
                  <span class="btn-icon">âš™ï¸</span>
                  Manage Firms
                </button>
              </div>
            </div>

            <div class="form-section">
              <h3 class="form-section-title">
                <span class="form-icon">ğŸ—ºï¸</span>
                Route Information
              </h3>
              <div class="route-inputs">
                <div class="input-group">
                  <label for="pointA" class="input-label">
                    <span class="label-icon">ğŸ </span>
                    Starting Location
                  </label>
                  <input
                    type="text"
                    id="pointA"
                    class="route-input"
                    placeholder="Enter your starting address..."
                  />
                  <div class="input-hint">
                    Your home base location will be saved for future use
                  </div>
                </div>
                <div class="route-arrow">â†’</div>
                <div class="input-group">
                  <label for="pointB" class="input-label">
                    <span class="label-icon">ğŸ“</span>
                    Destination
                  </label>
                  <input
                    type="text"
                    id="pointB"
                    class="route-input"
                    placeholder="Enter destination address..."
                  />
                  <div class="input-hint">
                    Distance will be calculated automatically
                  </div>
                </div>
              </div>
            </div>

            <div class="form-section">
              <h3 class="form-section-title">
                <span class="form-icon">ğŸ“</span>
                Distance & Options
              </h3>
              <div class="distance-options">
                <div class="input-group distance-input-group">
                  <label for="distanceMiles" class="input-label"
                    >Distance (Miles)</label
                  >
                  <div class="distance-input-wrapper">
                    <input
                      type="number"
                      id="distanceMiles"
                      class="distance-input"
                      placeholder="0.0"
                      step="0.1"
                      min="0"
                    />
                    <div class="distance-status" id="distanceStatus">
                      <span class="status-icon">ğŸ¯</span>
                      Auto-calculating...
                    </div>
                  </div>
                </div>
                <div class="trip-options">
                  <div class="checkbox-wrapper">
                    <label class="modern-checkbox">
                      <input type="checkbox" id="roundTrip" />
                      <span class="checkbox-custom"></span>
                      <span class="checkbox-label-text">
                        <span class="checkbox-title">Round Trip</span>
                        <span class="checkbox-subtitle"
                          >Double the distance for return journey</span
                        >
                      </span>
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-section">
              <h3 class="form-section-title">
                <span class="form-icon">ğŸ“</span>
                Additional Information
              </h3>
              <div class="input-group">
                <label for="noteField" class="input-label"
                  >Notes (Optional)</label
                >
                <textarea
                  id="noteField"
                  class="notes-input"
                  placeholder="Add any additional notes or special circumstances..."
                  rows="2"
                ></textarea>
              </div>
            </div>

            <div class="form-actions">
              <button id="calculateBtn" class="primary-action-btn">
                <span class="btn-icon">ğŸ§®</span>
                <span class="btn-text">Calculate Mileage</span>
                <span class="btn-loading" style="display: none">
                  <span class="loading-spinner"></span>
                  Calculating...
                </span>
              </button>
            </div>
          </div>
        </div>

        <!-- Results Section -->
        <div
          class="results-section cipher-glass-panel"
          id="resultsSection"
          style="display: none"
        >
          <div class="section-header">
            <div class="section-title">
              <span class="section-icon">ğŸ’°</span>
              <h2>Billing Results</h2>
            </div>
            <div class="section-subtitle">
              Your calculated mileage breakdown and billing amount
            </div>
          </div>

          <div class="results-content">
            <div class="breakdown-section">
              <h3 class="breakdown-title">
                <span class="breakdown-icon">ğŸ“Š</span>
                Calculation Breakdown
              </h3>
              <div id="breakdownDisplay" class="breakdown-display"></div>
            </div>

            <div class="copy-section">
              <h3 class="copy-title">
                <span class="copy-icon">ğŸ“‹</span>
                Copy for Billing
              </h3>
              <div class="copy-area">
                <div class="copy-container">
                  <textarea
                    id="copyText"
                    class="copy-textarea"
                    readonly
                    placeholder="Your billing calculation will appear here..."
                  ></textarea>
                  <div class="copy-actions">
                    <button id="copyBtn" class="copy-btn">
                      <span class="btn-icon">ğŸ“‹</span>
                      <span class="btn-text">Copy to Clipboard</span>
                      <span class="btn-success" style="display: none">
                        <span class="success-icon">âœ…</span>
                        Copied!
                      </span>
                    </button>
                  </div>
                </div>
                <div class="copy-hint">
                  This text is formatted for easy pasting into billing systems
                </div>
              </div>
            </div>

            <div class="results-actions">
              <button id="newCalculation" class="primary-action-btn secondary">
                <span class="btn-icon">ğŸ”„</span>
                New Calculation
              </button>
              <a href="settings-booth.html" class="settings-link">
                <span class="link-icon">âš™ï¸</span>
                Calculator Settings
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Firms Management Modal -->
      <div id="firmsModal" class="modal" style="display: none">
        <div class="modal-content">
          <div class="modal-header">
            <h3>ğŸ¢ Manage Firms</h3>
            <button class="close-btn" onclick="closeFirmsModal()">Ã—</button>
          </div>

          <div class="modal-body">
            <div class="firms-list">
              <h4>Current Firms</h4>
              <div id="firmsList"></div>
            </div>

            <div class="add-firm-section">
              <h4>Add New Firm</h4>
              <form id="addFirmForm">
                <div class="form-row">
                  <input
                    type="text"
                    id="firmName"
                    placeholder="Firm Name"
                    required
                  />
                  <input
                    type="number"
                    id="firmFreeMiles"
                    placeholder="Free Miles"
                    min="0"
                    step="1"
                    required
                  />
                </div>
                <div class="form-row">
                  <input
                    type="number"
                    id="firmRate"
                    placeholder="Rate per Mile"
                    min="0"
                    step="0.01"
                    required
                  />
                  <label class="checkbox-label">
                    <input type="checkbox" id="firmRoundTripDefault" />
                    <span class="checkmark"></span>
                    Round Trip Default
                  </label>
                </div>
                <button type="submit" class="add-btn">â• Add Firm</button>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Import from Route Modal -->
      <div id="routeImportModal" class="modal" style="display: none">
        <div class="modal-content">
          <div class="modal-header">
            <h3>ğŸ—ºï¸ Import from Route</h3>
            <button class="close-btn" onclick="closeRouteImportModal()">
              Ã—
            </button>
          </div>
          <div class="modal-body">
            <p>Route data detected! Would you like to import the distance?</p>
            <div id="routeImportData"></div>
            <div class="modal-actions">
              <button id="importRouteBtn" class="import-btn">âœ… Import</button>
              <button onclick="closeRouteImportModal()" class="cancel-btn">
                âŒ Cancel
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Toast notifications -->
      <div id="toastContainer" class="toast-container"></div>
    </main>

    <!-- Load API configuration first -->
    <script src="config/github-pages-env.js"></script>

    <!-- Google Maps Configuration (must load BEFORE api-config-production.js) -->
    <script src="scripts/google-config.js"></script>

    <script src="config/api-config-production.js"></script>

    <!-- Google Maps API Loader -->
    <script>
      // Load Google Maps API if key is configured
      if (
        window.GOOGLE_MAPS_CONFIG?.apiKey &&
        window.GOOGLE_MAPS_CONFIG.apiKey !==
          "YOUR_ACTUAL_GOOGLE_MAPS_API_KEY_HERE"
      ) {
        const script = document.createElement("script");
        script.src = `https://maps.googleapis.com/maps/api/js?key=${
          window.GOOGLE_MAPS_CONFIG.apiKey
        }&libraries=${window.GOOGLE_MAPS_CONFIG.libraries.join(",")}`;
        script.async = true;
        script.defer = true;
        script.onload = () =>
          console.log("ğŸ—ºï¸ Google Maps API loaded for Mileage Cypher");
        script.onerror = () =>
          console.error("ğŸ—ºï¸ Failed to load Google Maps API");
        document.head.appendChild(script);
      } else {
        console.log(
          "ğŸ—ºï¸ Google Maps API not configured - manual distance entry only"
        );
      }
    </script>

    <!-- Core Scripts -->
    <script src="scripts/cipher-core.js"></script>

    <!-- Load combined mileage calculator -->
    <script src="scripts/mileage-cypher-combined.js"></script>
  </body>
</html>
